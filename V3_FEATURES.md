# BuildFlow v3.0 - –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

## üéØ –û–±–∑–æ—Ä

BuildFlow v3.0 –¥–æ–±–∞–≤–ª—è–µ—Ç —á–µ—Ç—ã—Ä–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª—è –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ–º:

1. **üéôÔ∏è –ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç (AI Entry)**
2. **‚úÖ –ú–æ–¥—É–ª—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π (Change Orders)**
3. **üìä –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è**
4. **‚ú® –£–ª—É—á—à–µ–Ω–∏–µ UI/UX**

---

## 1. üéôÔ∏è –ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç (AI Entry)

### –ß—Ç–æ —ç—Ç–æ?
–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤–≤–æ–¥–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –≥–æ–ª–æ—Å–æ–º –≤–º–µ—Å—Ç–æ –ø–µ—á–∞—Ç–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üéôÔ∏è –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ö—É–ø–∏–ª 5 –º–µ—à–∫–æ–≤ —Ü–µ–º–µ–Ω—Ç–∞ –∑–∞ 250 —Ä—É–±–ª–µ–π")
3. –ë–æ—Ç:
   - –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç –≥–æ–ª–æ—Å —á–µ—Ä–µ–∑ **Whisper API** (OpenAI)
   - –ü–∞—Ä—Å–∏—Ç —Ä–∞—Å—Ö–æ–¥—ã —á–µ—Ä–µ–∑ **GPT-3.5** (—Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Å—É–º–º—É, –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –æ–ø–∏—Å–∞–Ω–∏–µ)
   - –ü—Ä–æ—Å–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ø—Ä–æ–µ–∫—Ç

### –¢—Ä–µ–±—É–µ–º—ã–µ API –∫–ª—é—á–∏
```bash
OPENAI_API_KEY=sk-...  # –ü–æ–ª—É—á–∏—Ç—å –Ω–∞ https://platform.openai.com
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- "–ö—É–ø–∏–ª —Ü–µ–º–µ–Ω—Ç –∑–∞ 500 —Ä—É–±–ª–µ–π"
- "–†–∞–±–æ—Ç–∞: –æ–ø–ª–∞—Ç–∏–ª —Ä–∞–±–æ—á–µ–º—É 2000"
- "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –Ω–∞ —Å—É–º–º—É 1500 - –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–µ—Å–∫–∞"

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- **Whisper API**: –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- **GPT-3.5-turbo**: –ü–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Å—Ö–æ–¥
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON: `{amount, category, description, confidence}`
- –¢–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ—Å–ª–∏ `confidence > 0.5`

---

## 2. ‚úÖ –ú–æ–¥—É–ª—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π (Change Orders)

### –ß—Ç–æ —ç—Ç–æ?
–°–∏—Å—Ç–µ–º–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ (Change Orders).

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
- –ü—Ä–æ—Ä–∞–± –≤–Ω–æ—Å–∏—Ç —Ä–∞—Å—Ö–æ–¥ ‚Üí "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞: +1000 BYN"
- –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑—á–∏–∫—É**
- –ó–∞–∫–∞–∑—á–∏–∫ **–æ–¥–æ–±—Ä—è–µ—Ç –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç** —Å –ø—Ä–∏—á–∏–Ω–æ–π
- –†–∞—Å—Ö–æ–¥ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è

### –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã

#### –ü—Ä–æ—Ä–∞–±:
1. –î–æ–±–∞–≤–ª—è–µ—Ç —Ä–∞—Å—Ö–æ–¥
2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å (pending/approved/rejected)
3. –ï—Å–ª–∏ pending ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∑–∞–∫–∞–∑—á–∏–∫—É

#### –ó–∞–∫–∞–∑—á–∏–∫:
1. –ü–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ!"
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç "‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è"
3. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏
4. –ù–∞–∂–∏–º–∞–µ—Ç "‚úÖ –û–¥–æ–±—Ä–∏—Ç—å" –∏–ª–∏ "‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å"
5. –ï—Å–ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É:
   - –ü—Ä–µ–≤—ã—à–µ–Ω –±—é–¥–∂–µ—Ç
   - –ü–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
   - –î—Ä—É–≥–æ–µ

### –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ë–î
```python
# database/models.py
class TransactionStatus(enum.Enum):
    PENDING = "pending"      # –û–∂–∏–¥–∞–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è
    APPROVED = "approved"    # –û–¥–æ–±—Ä–µ–Ω–æ
    REJECTED = "rejected"    # –û—Ç–∫–ª–æ–Ω–µ–Ω–æ

class ChangeOrder:
    id
    transaction_id  # FK –∫ Transaction
    status          # TransactionStatus
    requested_by_id # –ö—Ç–æ –∑–∞–ø—Ä–æ—Å–∏–ª (–ø—Ä–æ—Ä–∞–±)
    approved_by_id  # –ö—Ç–æ –æ–¥–æ–±—Ä–∏–ª (–∑–∞–∫–∞–∑—á–∏–∫)
    rejection_reason # –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
    created_at, updated_at
```

### CRUD —Ñ—É–Ω–∫—Ü–∏–∏
```python
from database import crud

# –°–æ–∑–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ
order = crud.create_change_order(session, transaction_id, requester_id)

# –ü–æ–ª—É—á–∏—Ç—å –æ–∂–∏–¥–∞—é—â–∏–µ
orders = crud.get_pending_change_orders(session)

# –û–¥–æ–±—Ä–∏—Ç—å
crud.approve_change_order(session, order_id, approver_id)

# –û—Ç–∫–ª–æ–Ω–∏—Ç—å
crud.reject_change_order(session, order_id, approver_id, reason)
```

---

## 3. üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ (Tasks)

### –ß—Ç–æ —ç—Ç–æ?
TODO –ª–∏—Å—Ç –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤ - –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–¥–∞—á —Ä–∞–±–æ—á–∏–º.

### –§—É–Ω–∫—Ü–∏–∏

#### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á:
1. –ù–∞–∑–≤–∞–Ω–∏–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
2. –û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. –ü—Ä–æ–µ–∫—Ç (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
4. –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–¥–∞—á
- –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é
- –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É
- –ù–∞–∑–Ω–∞—á–∏—Ç—å –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞

### –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ë–î
```python
class Task:
    id
    project_id      # FK –∫ Project
    title           # –ù–∞–∑–≤–∞–Ω–∏–µ
    description     # –û–ø–∏—Å–∞–Ω–∏–µ
    is_completed    # –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –ª–∏
    assigned_to_id  # –ö–æ–º—É –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ (FK –∫ User)
    due_date        # –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    created_at, updated_at
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```python
# –°–æ–∑–¥–∞—Ç—å
task = crud.create_task(
    session,
    project_id=1,
    title="–ü–æ–∫—Ä–∞—Å–∏—Ç—å —Å—Ç–µ–Ω—ã",
    description="–°—Ç–µ–Ω—ã –≤ –∫–æ–º–Ω–∞—Ç–µ 1",
    assigned_to_id=user_id,
    due_date=datetime(2024, 2, 15)
)

# –ü–æ–ª—É—á–∏—Ç—å
tasks = crud.get_project_tasks(session, project_id)
my_tasks = crud.get_assigned_tasks(session, user_id)

# –í—ã–ø–æ–ª–Ω–∏—Ç—å
crud.complete_task(session, task_id)
```

---

## 4. üìä –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

### A. –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (Alembic)

**–ó–∞—á–µ–º?**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ —Å—Ö–µ–º—ã –ë–î
- –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (rollback)
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å PostgreSQL/SQLite

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
```bash
pip install alembic
alembic init migrations
alembic revision --autogenerate -m "Add ChangeOrder and Task models"
alembic upgrade head
```

### B. Excel —ç–∫—Å–ø–æ—Ä—Ç

**–ù–æ–≤—ã–π –º–æ–¥—É–ª—å:** `bot/excel_export.py`

**–§—É–Ω–∫—Ü–∏–∏:**
```python
from bot.excel_export import export_project_to_excel

# –≠–∫—Å–ø–æ—Ä—Ç –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
excel_file = export_project_to_excel(
    project_name="–î–æ–º –Ω–∞ —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–æ–π",
    project_address="—É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥.1",
    budget=10000,
    transactions=[...],
    progress_photos=[...]
)

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
await callback.message.answer_document(
    FSInputFile(excel_file)
)
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç—á–µ—Ç–∞:**
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–¥—Ä–µ—Å, –±—é–¥–∂–µ—Ç)
- –¢–∞–±–ª–∏—Ü–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ (–¥–∞—Ç–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –æ–ø–∏—Å–∞–Ω–∏–µ, —Å—É–º–º–∞)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–ø–æ—Ç—Ä–∞—á–µ–Ω–æ, –æ—Å—Ç–∞–ª–æ—Å—å, –ø—Ä–æ—Ü–µ–Ω—Ç)
- –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (—Å–∫–æ–ª—å–∫–æ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, —Ä–∞–±–æ—Ç—É –∏ —Ç.–¥.)

### C. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (`database/session.py`):
```python
# –ï—Å–ª–∏ DATABASE_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Üí SQLite
# –ï—Å–ª–∏ DATABASE_URL=postgresql://... ‚Üí PostgreSQL
```

**–î–ª—è production:**
```bash
# .env
DATABASE_URL=postgresql://user:password@localhost:5432/buildflow
OPENAI_API_KEY=sk-...
```

---

## 5. ‚ú® –£–ª—É—á—à–µ–Ω–∏—è UI/UX

### A. HTML —Ä–∞–∑–º–µ—Ç–∫–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

**–ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç:**
```html
<b>–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç</b>
<i>–∫—É—Ä—Å–∏–≤</i>
<code>–º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π</code>
<pre>–±–ª–æ–∫ –∫–æ–¥–∞</pre>
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```python
# –ë—ã–ª–æ:
"–°—É–º–º–∞: 500 BYN"

# –°—Ç–∞–ª–æ:
"üí∞ <b>–°—É–º–º–∞:</b> 500 BYN"
"‚úÖ <b>–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ!</b>"
"‚ùå <b>–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ ID –ø—Ä–æ–µ–∫—Ç–∞</b>"
```

### B. –£–ª—É—á—à–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ:**
```
üìã –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ!

üë∑ –û—Ç: –ò–≤–∞–Ω –°–∏–¥–æ—Ä–æ–≤
üí∞ –°—É–º–º–∞: 1,500.00 BYN
üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: üèóÔ∏è –ú–∞—Ç–µ—Ä–∏–∞–ª—ã
üìù –û–ø–∏—Å–∞–Ω–∏–µ: –ö—É–ø–∏–ª —Ü–µ–º–µ–Ω—Ç –¥–ª—è —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞

[‚úÖ –û–¥–æ–±—Ä–∏—Ç—å] [‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å]
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏:**
```
üìå –í–∞–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞!

üìù –ó–∞–¥–∞—á–∞: –ü–æ–∫—Ä–∞—Å–∏—Ç—å —Å—Ç–µ–Ω—ã
üë§ –ù–∞–∑–Ω–∞—á–∏–ª: –ò–≤–∞–Ω –°–∏–¥–æ—Ä–æ–≤

[üìã –ú–æ–∏ –∑–∞–¥–∞—á–∏]
```

### C. –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é v2

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –º–µ–Ω—é:**
```
üìÇ –ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã
‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
üí∞ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥
üéôÔ∏è –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥          ‚Üê –ù–û–í–û–ï
üì∏ –§–æ—Ç–æ –æ—Ç—á—ë—Ç
üìä –û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–µ–∫—Ç—É
üìã –ú–æ–∏ –∑–∞–¥–∞—á–∏              ‚Üê –ù–û–í–û–ï
‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è            ‚Üê –ù–û–í–û–ï
üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel         ‚Üê –ù–û–í–û–ï
‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
```

---

## 6. üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
```bash
pip install -r requirements.txt
```

### .env —Ñ–∞–π–ª
```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
BOT_TOKEN=your_telegram_bot_token

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é SQLite)
DATABASE_URL=postgresql://user:pass@localhost/buildflow

# –î–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞
OPENAI_API_KEY=sk-...
```

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
```bash
python main.py
```

---

## 7. üìù –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥
```python
# bot/handlers/voice_input.py
@router.message(VoiceInputState.waiting_audio, F.voice)
async def process_voice_message(message: Message, state: FSMContext):
    # 1. –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
    # 2. –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ Whisper
    text = await transcribe_audio_whisper(voice_path)
    
    # 3. –ü–∞—Ä—Å–∏–º —á–µ—Ä–µ–∑ GPT
    expense = await parse_expense_from_voice(text)
    # expense = {"amount": 500, "category": "materials", ...}
    
    # 4. –ü—Ä–æ—Å–∏–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    # 5. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
```

### –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
```python
# bot/handlers/tasks_approvals.py
@router.callback_query(F.data.startswith("approve_"))
async def cb_approve_request(callback: CallbackQuery):
    order_id = int(callback.data.replace("approve_", ""))
    crud.approve_change_order(session, order_id, callback.from_user.id)
    # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å APPROVED
```

### –ó–∞–¥–∞—á–∏
```python
# –°–æ–∑–¥–∞–Ω–∏–µ
task = crud.create_task(
    session,
    project_id=1,
    title="–ü–æ–∫—Ä–∞—Å–∫–∞",
    assigned_to_id=user_id
)

# –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–∏—Ö
my_tasks = crud.get_assigned_tasks(session, user_id)
```

### Excel —ç–∫—Å–ø–æ—Ä—Ç
```python
# bot/handlers/base.py
@router.callback_query(F.data == "menu_export_excel")
async def cb_export_excel(callback: CallbackQuery):
    excel = export_project_to_excel(
        project_name="...",
        transactions=[...]
    )
    await callback.message.answer_document(FSInputFile(excel))
```

---

## 8. üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### Problem: "–æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ id –ø—Ä–æ–µ–∫—Ç–∞"
**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è callback patterns
**–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ v3.0 - –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ callback_data

### Problem: Whisper/GPT –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `OPENAI_API_KEY` –≤ .env
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ API –∫–ª—é—á –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –≤ OpenAI console

### Problem: –ë–î –æ—à–∏–±–∫–∏
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
alembic upgrade head
```

---

## 9. üìö –§–∞–π–ª—ã v3.0

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|---------|
| `database/models.py` | +TransactionStatus, ChangeOrder, Task |
| `database/crud.py` | +CRUD –¥–ª—è ChangeOrder –∏ Task |
| `bot/excel_export.py` | –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel |
| `bot/handlers/tasks_approvals.py` | –ó–∞–¥–∞—á–∏ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è |
| `bot/handlers/voice_input.py` | –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ |
| `bot/utils.py` | +Whisper, GPT, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `bot/keyboards/common.py` | +–ù–æ–≤—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã |
| `requirements.txt` | +openai, pandas, openpyxl, alembic |

---

## 10. üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?

- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –≤–µ–±—Ö—É–∫–æ–º (–≤–º–µ—Å—Ç–æ polling)
- [ ] –î–æ–±–∞–≤–∏—Ç—å notifications –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (webhook)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å Stripe –¥–ª—è –æ–ø–ª–∞—Ç
- [ ] –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Flutter)
- [ ] Analytics –∏ –≥—Ä–∞—Ñ–∏–∫–∏ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Drive

---

**–í–µ—Ä—Å–∏—è:** 3.0.0  
**–î–∞—Ç–∞:** 2024-01-15  
**–ê–≤—Ç–æ—Ä:** BuildFlow Team
